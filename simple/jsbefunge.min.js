var jsBefunge={};
(function($jb){$jb.EventManage=function(){this.events={};};$jb.EventManage.prototype.on=function(target,func){if(!this.events[target])
this.events[target]=[];this.events[target].push(func);return this.events[target].length-1;};$jb.EventManage.prototype.off=function(target,eventID){if(!this.events[target])return;this.events[target][eventID]=null;};$jb.EventManage.prototype.fire=function(target,_this,args){if(!this.events[target])return;for(var _i=0,_m=this.events[target].length;_i<_m;_i++){var event=this.events[target][_i];event.call(_this,_this,args);}};$jb.EventManage.prototype.defineFire=function(clsname,functions){for(var _key in functions){(function(_item){eval("$jb."+clsname+".prototype."+_key+"= function() {"+"var _v = _item.apply(this, arguments);"+"this._event.fire('"+clsname+"."+_key+"', this, arguments);"+"$jb.Event.fire('"+clsname+"."+_key+"', this, arguments);"+"return _v;"+"};");})(functions[_key]);}};$jb.Event=new $jb.EventManage();$jb.Buffer=function(){this.pos=0;this.buffer="";this._event=new jsBefunge.EventManage();};$jb.Buffer.prototype.clear=function(){this.buffer="";this.pos=0;};$jb.Buffer.prototype.set=function(str){this.buffer=str;this.pos=0;};$jb.Buffer.prototype.add=function(str){this.buffer+=str;};$jb.Buffer.prototype.get=function(nonMove){if(this.buffer.length<=this.pos)
return"";var c=this.buffer.charAt(this.pos);if(!nonMove)this.pos++;return c;};$jb.InputBuffer=function(){$jb.Buffer.apply(this);};$jb.InputBuffer.prototype=new $jb.Buffer();$jb.InputBuffer.prototype.__super=$jb.Buffer.prototype;var fnames=["clear","set"]
var funcs={};for(var _i=0,_m=fnames.length;_i<_m;_i++){var _item=fnames[_i];funcs[_item]=new Function("this.__super."+_item+".apply(this, arguments);");}
$jb.Event.defineFire("InputBuffer",funcs);$jb.Result=function(){$jb.Buffer.apply(this);};$jb.Result.prototype=new $jb.Buffer();$jb.Result.prototype.__super=$jb.Buffer.prototype;var fnames=["clear","add","set"]
var funcs={};for(var _i=0,_m=fnames.length;_i<_m;_i++){var _item=fnames[_i];funcs[_item]=new Function("this.__super."+_item+".apply(this, arguments);");}
$jb.Event.defineFire("Result",funcs);$jb.Stack=function(){Array.apply(this);this._event=new jsBefunge.EventManage();};$jb.Stack.prototype=new Array();$jb.Stack.prototype.__super=Array.prototype;$jb.Stack.prototype.reverse=function(){return Array.prototype.slice.call(this).reverse();};$jb.Stack.prototype.reverse_self=function(){this.__super.reverse(arguments);};$jb.Stack.prototype.clear=function(){this.length=0;this._event.fire("Stack.clear", this);$jb.Event.fire("Stack.clear",this);};var funcs={"push":function(){this.__super.push.apply(this,arguments);},"pop":function(){return this.__super.pop.apply(this,arguments);},};$jb.Event.defineFire("Stack",funcs);$jb.Code=function(){this.wait=16;this.direction=6;this.pos=[0,0];this.c='';this.source=[];this.lenmax=0;this.running=false;this.timer=null;this.strings=false;this._event=new jsBefunge.EventManage();this.Stack=new $jb.Stack();this.Result=new $jb.Result();this.InputBuffer=new $jb.InputBuffer();this.Stack._event=this._event
this.Result._event=this._event
this.InputBuffer._event=this._event};$jb.Code.prototype.init=function(src){this.Stack.clear();this.Result.clear();this.InputBuffer.pos=0;this.direction=6;this.pos=[0,0];this.c="";this.lenmax=0;this.running=false;this.timer=0;this.strings=false;this.source=src.split("\n");for(var i in this.source){if(this.lenmax<this.source[i].length)
this.lenmax=this.source[i].length;}
for(var i in this.source){if(this.lenmax>this.source[i].length)
this.source[i]+=new Array(this.lenmax-this.source[i].length+1).join(' ');}
this.c=this.source[0].charAt(0);this.eventFire("Code.init",this);};$jb.Code.prototype.next=function(){if(!this.running)return;this.pos[0]+=this.direction==4?-1:(this.direction==6?1:0);this.pos[1]+=this.direction==8?-1:(this.direction==2?1:0);if(this.pos[0]>this.lenmax-1)this.pos[0]=0;if(this.pos[0]<0)this.pos[0]=this.lenmax-1;if(this.pos[1]>this.source.length-1)this.pos[1]=0;if(this.pos[1]<0)this.pos[1]=this.source.length-1;this.c=this.source[this.pos[1]].charAt(this.pos[0]);};$jb.Code.prototype.run=function(src,initOnly){var _this=this;if(_this.running==false){_this.stop(true);_this.init(src);_this.running=true;}
if(!initOnly){_this.timer=setInterval(function(){if(!_this.step()){_this.stop();_this.eventFire("Code.end",_this);}},this.wait);}
_this.eventFire("Code.run",this);};$jb.Code.prototype.stop=function(abord){clearInterval(this.timer);if(abord){this.running=false;this.eventFire("Code.stop",this);}else{this.eventFire("Code.pause",this);}};$jb.Code.prototype.step=function(){this.eventFire("Code.beforeStep",this);var val=this._step();this.eventFire("Code.step",this);this.eventFire("Code.afterStep",this);return val;}
$jb.Code.prototype._step=function(){if(!this.running)return false;if(this.strings){if(this.c!='"'){this.Stack.push(this.c.charCodeAt(0));this.next();}else{this.next();this.strings=false;}
return true;}
switch(this.c){case'#':this.next();break;case'v':this.direction=2;break;case'<':this.direction=4;break;case'>':this.direction=6;break;case'^':this.direction=8;break;case'_':case'|':var d=this.Stack.pop();this.direction=this.c=='_'?(d==0?6:4):(d==0?2:8)
break;case'?':this.direction=parseInt(Math.random()*4)*2;break;case'0':case'1':case'2':case'3':case'4':case'5':case'6':case'7':case'8':case'9':this.Stack.push(parseInt(this.c));break;case'"':this.strings=true;break;case'&':this.Stack.push(String.fromCharCode(this.InputBuffer.get()));break;case'~':this.Stack.push(this.InputBuffer.get());break;case'.':this.Result.add(this.Stack.pop()+' ');break;case',':this.Result.add(String.fromCharCode(this.Stack.pop()));break;case'+':case'-':case'*':case'/':case'%':var a=this.Stack.pop();var b=this.Stack.pop();this.Stack.push(eval("("+b+")"+this.c+"("+a+")"));break;case'`':var n=this.Stack.pop();this.Stack.push(this.Stack.pop()>n?1:0);break;case'!':this.Stack.push(this.Stack.pop()?0:1);break;case':':var n=this.Stack.pop();this.Stack.push(n);this.Stack.push(n);break;case"\\":var a=this.Stack.pop();var b=this.Stack.pop();this.Stack.push(a);this.Stack.push(b);break;case'$':this.Stack.pop();break;case'g':var y=this.Stack.pop();var x=this.Stack.pop();var v=this.source[y].charCodeAt(x);this.Stack.push(v);break;case'p':var y=this.Stack.pop();var x=this.Stack.pop();var v=this.Stack.pop();this.source[y]=this.source[y].substring(0,x)
+String.fromCharCode(v)
+(x+1==this.source[y].length?'':this.source[y].substring(x+1,this.source[y].length));break;case' ':break;case'@':return false;break;default:break;}
this.next();return true;};$jb.Code.prototype.eventFire=function(target,_this,args){this._event.fire(target,_this,args);$jb.Event.fire(target,_this,args);};})(jsBefunge);